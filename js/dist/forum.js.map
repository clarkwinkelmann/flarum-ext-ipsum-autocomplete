{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/ipsum-autocomplete/webpack/bootstrap","webpack://@clarkwinkelmann/ipsum-autocomplete/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/ipsum-autocomplete/webpack/runtime/define property getters","webpack://@clarkwinkelmann/ipsum-autocomplete/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/ipsum-autocomplete/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/ipsum-autocomplete/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/ipsum-autocomplete/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/ipsum-autocomplete/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@clarkwinkelmann/ipsum-autocomplete/external root \"flarum.core.compat['forum/utils/KeyboardNavigatable']\"","webpack://@clarkwinkelmann/ipsum-autocomplete/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/ipsum-autocomplete/external root \"flarum.core.compat['common/Fragment']\"","webpack://@clarkwinkelmann/ipsum-autocomplete/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/ipsum-autocomplete/./src/forum/fragments/AutocompleteDropdown.ts","webpack://@clarkwinkelmann/ipsum-autocomplete/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/ipsum-autocomplete/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/KeyboardNavigatable'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Fragment'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import app from 'flarum/forum/app';\nimport Fragment from 'flarum/common/Fragment';\nimport Button from 'flarum/common/components/Button';\n\nexport default class AutocompleteDropdown extends Fragment {\n    active = false\n    ipsumInsertStart = 0\n    paragraphs = 1\n\n    view() {\n        return Button.component({\n            className: 'Button LoremIpsumAutocomplete',\n            onclick: this.apply.bind(this),\n        }, app.translator.trans('clarkwinkelmann-ipsum-autocomplete.forum.insert', {\n            input: m('input', {\n                type: 'number',\n                min: 1,\n                step: 1,\n                value: this.paragraphs,\n                onchange: (event: InputEvent) => {\n                    this.paragraphs = parseInt((event.target as HTMLInputElement).value);\n                },\n                onclick: (event: Event) => {\n                    // Don't submit the button when placing cursor in input\n                    event.stopPropagation();\n                },\n            }),\n        }));\n    }\n\n    show(left: number = 0, top: number = 0) {\n        this.$()\n            .show()\n            .css({\n                left: left + 'px',\n                top: top + 'px',\n            });\n        this.active = true;\n    }\n\n    hide() {\n        this.$().hide();\n        this.active = false;\n    }\n\n    up() {\n        this.paragraphs++;\n        this.refreshInput();\n    }\n\n    down() {\n        this.paragraphs = Math.max(this.paragraphs - 1, 1);\n        this.refreshInput();\n    }\n\n    refreshInput() {\n        this.$('input').val(this.paragraphs);\n    }\n\n    apply() {\n        app.request<any>({\n            url: app.forum.attribute('apiUrl') + '/lorem-ipsum-autocomplete',\n            method: 'GET',\n            params: {\n                paragraphs: this.paragraphs,\n            },\n        }).then(response => {\n            app.composer.editor!.replaceBeforeCursor(this.ipsumInsertStart, response.text, false);\n            this.paragraphs = 1;\n\n            this.hide();\n        });\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/forum/app';\nimport {extend} from 'flarum/common/extend';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport KeyboardNavigatable from 'flarum/forum/utils/KeyboardNavigatable';\nimport AutocompleteDropdown from './fragments/AutocompleteDropdown';\n\n// Code based on Flarum's Mentions addComposerAutocomplete\napp.initializers.add('clarkwinkelmann-ipsum-autocomplete', () => {\n    const $container = $('<div class=\"ComposerBody-loremIpsumDropdownContainer\"></div>');\n    const dropdown = new AutocompleteDropdown();\n\n    extend(TextEditor.prototype, 'oncreate', function () {\n        const $editor = this.$('.TextEditor-editor').wrap('<div class=\"ComposerBody-loremIpsumWrapper\"></div>');\n\n        this.loremIpsumNavigator = new KeyboardNavigatable();\n        this.loremIpsumNavigator\n            .when(() => dropdown.active)\n            .onUp(dropdown.up.bind(dropdown))\n            .onDown(dropdown.down.bind(dropdown))\n            .onSelect(dropdown.apply.bind(dropdown))\n            .onCancel(dropdown.hide.bind(dropdown))\n            .bindTo($editor);\n\n        $editor.after($container);\n    });\n\n    extend(TextEditor.prototype, 'buildEditorParams', function (params) {\n        params.inputListeners.push((() => {\n            const selection = this.attrs.composer.editor.getSelectionRange();\n\n            const cursor = selection[0];\n\n            // If there's an active selection, do nothing\n            if (selection[1] - cursor > 0) return;\n\n            const lastChunk = this.attrs.composer.editor.getLastNChars(16);\n\n            let matchIndex = lastChunk.search(/lorem(\\s*ipsum)?(\\s*[0-9]+)?$/i);\n\n            if (matchIndex === -1) {\n                matchIndex = lastChunk.search(/ipsum(\\s*[0-9]+)?$/);\n            }\n\n            dropdown.hide();\n\n            if (matchIndex !== -1) {\n                const numberMatch = /[m\\s]([1-9][0-9]*)$/.exec(lastChunk);\n                if (numberMatch) {\n                    dropdown.paragraphs = parseInt(numberMatch[1]);\n                }\n\n                dropdown.ipsumInsertStart = cursor - lastChunk.length + matchIndex;\n\n                m.render($container[0], dropdown.render());\n\n                dropdown.show();\n                const coordinates = this.attrs.composer.editor.getCaretCoordinates(dropdown.ipsumInsertStart);\n                const width = dropdown.$().outerWidth();\n                const height = dropdown.$().outerHeight();\n                const parent = dropdown.$().offsetParent();\n                let left = coordinates.left;\n                let top = coordinates.top + 15;\n\n                // Keep the dropdown inside the editor.\n                if (top + height > parent.height()) {\n                    top = coordinates.top - height - 15;\n                }\n                if (left + width > parent.width()) {\n                    left = parent.width() - width;\n                }\n\n                // Prevent the dropdown from going off screen on mobile\n                top = Math.max(-(parent.offset().top - $(document).scrollTop()), top);\n                left = Math.max(-parent.offset().left, left);\n\n                dropdown.show(left, top);\n            }\n        }) as never);\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","AutocompleteDropdown","subClass","superClass","active","ipsumInsertStart","paragraphs","create","constructor","view","Button","className","onclick","this","apply","app","input","m","type","min","step","onchange","event","parseInt","target","stopPropagation","show","left","top","$","css","hide","up","refreshInput","down","Math","max","val","url","method","params","then","response","text","Fragment","$container","dropdown","extend","TextEditor","$editor","wrap","loremIpsumNavigator","KeyboardNavigatable","when","onUp","onDown","onSelect","onCancel","bindTo","after","inputListeners","push","selection","attrs","composer","editor","getSelectionRange","cursor","lastChunk","getLastNChars","matchIndex","search","numberMatch","exec","length","render","coordinates","getCaretCoordinates","width","outerWidth","height","outerHeight","parent","offsetParent","offset","document","scrollTop"],"sourceRoot":""}